- id: bathroom_001
  alias: bathroom_001
  trigger:
    platform: state
    entity_id: sensor.0x00158d00033e347d_click
    to:
      - 'left'
      - 'left_double'
      - 'right'
      - 'right_double'
  action:
    service_template: >
      {% if trigger.to_state.state == 'left' or trigger.to_state.state == 'left_double' %}
        {% if is_state('light.hue_candle_bathroom_l', 'off') %}
          script.turn_on
        {% else %}
          light.turn_off
        {% endif %}
      {% elif trigger.to_state.state == 'right' or trigger.to_state.state == 'right_double' %}
        {% if is_state('light.hue_bulb_bathroom_r', 'off') %}
          script.turn_on
        {% else %}
          light.turn_off
        {% endif %}
      {% endif %}
    data_template:
      entity_id: >
        {% if trigger.to_state.state == 'left' or trigger.to_state.state == 'left_double' %}
          {% if is_state('light.hue_candle_bathroom_l', 'off') %}
            {% if is_state('input_boolean.time_for_dim_scenes', 'on') and trigger.to_state.state == 'left' %}
              script.scene_bathroom_l_night
            {% else %}
              script.scene_bathroom_l_day
            {% endif %}
          {% else %}
            light.hue_candle_bathroom_l
          {% endif %}
        {% elif trigger.to_state.state == 'right' or trigger.to_state.state == 'right_double' %}
          {% if is_state('light.hue_bulb_bathroom_r', 'off') %}
            {% if is_state('input_boolean.time_for_dim_scenes', 'on') and trigger.to_state.state == 'right' %}
              script.scene_bathroom_r_night
            {% else %}
              script.scene_bathroom_r_day
            {% endif %}
          {% else %}
            light.hue_bulb_bathroom_r
          {% endif %}
        {% endif %}


- id: bathroom_002
  alias: bathroom_002
  trigger:
    - platform: state
      entity_id: binary_sensor.bathroom_motion_detected
      to: 'on'
    - platform: state
      entity_id: binary_sensor.bathroom_motion_detected
      to: 'off'
      for:
        minutes: "{{ states('input_number.bathroom_motion_timeout')| int }}"
    - platform: state
      entity_id: binary_sensor.bathroom_dark_enough
      to: 'off'
      for:
        minutes: 5
  action:
    service: script.turn_on
    data_template:
      entity_id: script.set_dynamic_scene
      variables:
        service: script.turn_on
        trigger_to_state: '{{ trigger.to_state.state }}'
        dark_enough: '{{ states("binary_sensor.bathroom_dark_enough") }}'
        scene_day: 'script.scene_bathroom_day'
        scene_night: 'script.scene_bathroom_night'
        light_group: 'light.lg_bathroom_all'
