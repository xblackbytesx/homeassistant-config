- id: hw_001
  alias: hw_001
  trigger:
    - platform: state
      entity_id: binary_sensor.hw_motion_detected
      to: 'on'
    - platform: state
      entity_id: binary_sensor.hw_motion_detected
      to: 'off'
      for:
        minutes: 3
    - platform: state
      entity_id: binary_sensor.hw_dark_enough
      to: 'off'
      for:
        minutes: 5
  action:
    - service: script.turn_on
      data_template:
        entity_id: script.set_dynamic_scene
        variables:
          service: script.turn_on
          trigger_to_state: '{{ trigger.to_state.state }}'
          dark_enough: '{{ states("binary_sensor.hw_dark_enough") }}'
          scene_day: 'script.scene_hw_day'
          scene_night: 'script.scene_hw_night'
          light_group: 'light.lg_hw_all'
    - service_template: >
        {% if trigger.to_state.state == 'off' %}
          switch.turn_off
        {% else %}
          switch.turn_on
        {% endif %}
      data_template:
        entity_id: >
          {% if trigger_to_state == 'off' %}
            switch.0x000d6ffffedc5e05_switch
          {% else %}
            none
          {% endif %}